{% extends "base.html" %}
{% load static %}
{% load i18n %}

{% block title %}Membuat Akun Baru{% endblock title %}

{% block head_title %}
{% trans "Signup" %}{% endblock %}

{{ block.super }}
{% block content %}
<div class="shadow-wrap">
    <div class="form-wrap">
        <h2 style="text-align: center;">Daftar Akun Baru</h2>
        
        <form class="signup" id="signup_form" method="post" action="{% url 'account_signup' %}">
            {% csrf_token %}
            
            {% for field in form %}
                {% if field.name != 'captcha' %}
                    <div class="form-field-container">
                        <label for="{{ field.id_for_label }}">{{ field.label }}:</label>
                        {{ field }}
                        {% if field.help_text %}
                            <div class="help-text">{{ field.help_text|safe }}</div>
                        {% endif %}
                        {% for error in field.errors %}
                            <div class="error">{{ error }}</div>
                        {% endfor %}
                    </div>
                {% endif %}
            {% endfor %}

            <input type="hidden" name="g-recaptcha-response" id="id_g-recaptcha-response">

            <button type="submit" class="reset-pass" style="width: 100%; margin-top: 20px;">Daftar</button>
            <p style="text-align: center; color: #545D7A; margin-bottom: 30px; margin-top: 35px;">
            Sudah punya akun? <a href="{% url 'account_login' %}" class="signup-link">Masuk di sini</a>.
            </p>

            {# {% include 'account\social_logins.html' %} #}
        </form>
    </div>
</div>

<!--PERINGATAN! DI RENDER INI DAN SETELAH "grecaptcha.execute" WAJIB GANTI KUNCINYA SEBELUM DI KIRIM KE GITHUB!-->
<script src="https://www.google.com/recaptcha/api.js?render={{ site_key_v3 }}"></script>
<script>
    document.getElementById('signup_form').addEventListener('submit', function(e) {
        e.preventDefault();
        
        grecaptcha.ready(function() {
            grecaptcha.execute('{{ site_key_v3 }}', {action: 'authView'}).then(function(token) {
                document.getElementById('id_g-recaptcha-response').value = token;
                document.getElementById('signup_form').submit();
            });
        });
    });
</script>

{% endblock %}