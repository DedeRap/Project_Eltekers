{% extends "base.html" %}
{% load static %}

{% block content %}
{% if user.is_authenticated %}
<div class="shadow-wrap">
    <div class="form-wrap">
        <h2 style="text-align: center; margin-bottom: 25px;">Edit Profile</h2>
        
        <form method="post" enctype="multipart/form-data" id="profileForm">
            {% csrf_token %}

            {% for field in form %}
                <div class="form-field-container">
                    {{ field.label_tag }}
                    
                    {% if field.name == 'image' %}
                        <div class="image-field-wrapper">
                            {{ field }}
                        </div>
                    {% else %}
                        {{ field }}
                    {% endif %}

                    {% for error in field.errors %}
                        <div class="error">{{ error }}</div>
                    {% endfor %}
                </div>
            {% endfor %}

            <input type="hidden" name="g-recaptcha-response" id="id_g-recaptcha-response">

            <button type="submit" class="reset-pass" style="width: 100%; margin-top: 20px;">Save Changes</button>
        </form>
    </div>
</div>

{% else %}
<div class="shadow-wrap">
    <div class="form-wrap">
        <h1>404 Error Successful</h1>
        <p>Tidak ada apa pun di halaman ini. Silahkan kembali ke <a href="{% url 'home' %}">halaman Home!</a></p>
    </div>
</div>
{% endif %}

<script src="https://www.google.com/recaptcha/api.js?render={{ site_key_v3 }}"></script>
<script>
    document.getElementById('profileForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        grecaptcha.ready(function() {
            grecaptcha.execute('{{ site_key_v3 }}', {action: 'profile_edit'}).then(function(token) {
                document.getElementById('id_g-recaptcha-response').value = token;
                document.getElementById('profileForm').submit();
            });
        });
    });
</script>

{% endblock content %}